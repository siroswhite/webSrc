core = require("core")
html = require('html')

###*
  @class web.gui
    guiをコントロールします。
###
class gui
  constructor: () ->
    @id = ""

###*
  @class web.gui.slider
    スライダーをコントロールします。
###
class slider extends gui
  constructor: (arg) ->
    super()
    @val = 0
    @name = "slider"
    @param =
      max: 100
      min: 0
      step: 1
      range: false
    core.obj.marge(@, arg) if arg

  makeDom: () ->
    html.dom.slider(@id + "-slider")

  initEvent: (callback) ->
    $("#" + @id + "-slider").slider(
      max: @param.max
      min: @param.min
      step: @param.step
      if !@param.range
        value: @val
      if @param.range
        values: @val
      if @param.range
        range: @param.range 
    )

    $("#" + @id + "-slider").bind 'slide', (e, ui) =>
      @val = ui.value
      @val = ui.values if ui.values
      @setGuiVal()
      callback.arg.unshift @val
      callback.arg.unshift @id
      callback.method callback.arg... if callback

    $("#" + @id + "-slider_input").bind 'change', (e) =>
      @val = $(e.currentTarget).val()
      @setGuiVal()
      callback.arg.unshift @val
      callback.arg.unshift @id
      callback.method callback.arg... if callback

  setGuiVal: () ->
    if @param.range
      @val = @val.split(",") if !Array.isArray(@val)
      $("#" + @id + "-slider").slider(values:@val)
    else
      $("#" + @id + "-slider").slider(value:@val)
    $("#" + @id + "-slider_input").val(@val)

###*
  @class web.gui.selectBox
    セレクトボックスをコントロールします。
###
class selectBox extends gui
  constructor: (arg) ->
    super()
    @val = ""
    @name = "selectBox"
    @option = []
    core.obj.marge(@, arg) if arg

  makeDom: () ->
    html.dom.selectBox(@id + "-selectBox", @option)

  initEvent: (callback) ->
    $("#" + @id + "-selectBox").change (e) =>
      @val = $(e.currentTarget).val()
      @setGuiVal()
      callback.arg.unshift @val
      callback.arg.unshift @id
      callback.method callback.arg... if callback

  setGuiVal: () ->
    $("#" + @id + "-selectBox").val(@val)

module.exports = {
  gui: gui
  slider: slider
  selectBox: selectBox
}