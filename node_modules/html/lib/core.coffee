###*
  @class html.core
  基本となるメソッドを扱います。
###
core = require('core')

#==============================================================================
# method
#==============================================================================
###*
  @method make
  dom配列データをhtmlに変換します。
  @param {Array} dom 変換するdomデータ
  @param {Number} [level=0] インデントレベル
  @return {String} htmlコード
###
exports.make = (dom, level=0) ->
  addHtmlLine = (htmlLine, level) ->
    level + htmlLine + "\n"
    
  getClosedTag = (nowHtmlLine, level) ->
    tagCheck = (tag) ->
      if tag != "br"
        true
    tag = ""
    tagName = nowHtmlLine.split(">")[0].split(" ")[0].substr(1)
    if tagName != "br"
      tag = level + "</" + tagName + ">" + "\n"
    tag
  
  formatTag = (tag, attrList, val) ->
    getOpenedTag = (tag) ->
      "<" + tag
      
    getAttr = (attrList) ->
      checkDataPrefix = (key, attr) ->
        if key.indexOf("data") != -1
          key = "data" + "-" + attr[0]
          attr = attr[1]
        {key: key, attr: attr}
        
      str = ""
      for key, attr of attrList
        checkData = checkDataPrefix(key, attr)
        key = checkData.key
        attr = checkData.attr
        
        str += " " + key + "=" + core.str.addDQ(attr)
      str
      
    closeOpenedTag = () ->
      ">"
      
    getValue = (val) ->
      if val != undefined then val else ""
      
    str = getOpenedTag(tag)
    str += getAttr(attrList)
    str += closeOpenedTag()
    str += getValue(val)
  
  html = closedTag = ""  
  for htmlLine in dom
    if htmlLine[0] instanceof Array
      html += @make(htmlLine, level + 1)
    else
      htmlLine = formatTag(htmlLine[0], htmlLine[1], htmlLine[2])
      if closedTag != ""
        html += closedTag
      closedTag = getClosedTag(htmlLine, @getIndent(level))
      html += addHtmlLine(htmlLine, @getIndent(level))
      
  html += closedTag

#------------------------------------------------------------------------------
# getTab
#------------------------------------------------------------------------------
exports.getIndent = (num) ->
  str = ""
  for index in [0...num]
    str += "\t"
  str

